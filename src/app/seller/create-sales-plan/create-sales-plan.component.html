<div class="container mt-5">
  <h2 class="mb-4">{{ 'SALES_PLAN.CREATE_TITLE' | translate }}</h2>

  <form [formGroup]="salesPlanForm" (ngSubmit)="onSubmit()" class="mb-5">
    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="name" class="form-label">{{ 'SALES_PLAN.NAME' | translate }}</label>
          <input
            type="text"
            id="name"
            class="form-control"
            formControlName="name"
            placeholder="{{ 'SALES_PLAN.NAME_PLACEHOLDER' | translate }}"
            [class.is-valid]="salesPlanForm.get('name')?.valid && (salesPlanForm.get('name')?.dirty || salesPlanForm.get('name')?.touched)"
            [class.is-invalid]="fieldIsInvalid('name')"
          />
          <div *ngIf="fieldIsInvalid('name')" class="text-danger small mt-1">
            {{ 'SALES_PLAN.NAME_REQUIRED' | translate }}
          </div>
        </div>

        <div class="mb-3">
          <label for="description" class="form-label">{{ 'SALES_PLAN.DESCRIPTION' | translate }}</label>
          <textarea
            id="description"
            class="form-control"
            formControlName="description"
            rows="3"
            placeholder="{{ 'SALES_PLAN.DESCRIPTION_PLACEHOLDER' | translate }}"
            [class.is-valid]="salesPlanForm.get('description')?.valid && (salesPlanForm.get('description')?.dirty || salesPlanForm.get('description')?.touched)"
            [class.is-invalid]="fieldIsInvalid('description')"
          ></textarea>
          <div *ngIf="fieldIsInvalid('description')" class="text-danger small mt-1">
            {{ 'SALES_PLAN.DESCRIPTION_REQUIRED' | translate }}
          </div>
        </div>

        <div class="mb-3">
          <label for="visitRoute" class="form-label">{{ 'SALES_PLAN.ROUTE' | translate }}</label>
          <select
            id="visitRoute"
            class="form-select"
            formControlName="visitRoute"
            [class.is-valid]="salesPlanForm.get('visitRoute')?.valid && (salesPlanForm.get('visitRoute')?.dirty || salesPlanForm.get('visitRoute')?.touched)"
            [class.is-invalid]="fieldIsInvalid('visitRoute')"
          >
            <option value="" disabled>{{ 'SALES_PLAN.SELECT_ROUTE' | translate }}</option>
            <option *ngFor="let route of availableRoutes" [value]="route">
              {{ 'SALES_PLAN.ROUTES.' + route | translate }}
            </option>
          </select>
          <div *ngIf="fieldIsInvalid('visitRoute')" class="text-danger small mt-1">
            {{ 'SALES_PLAN.ROUTE_REQUIRED' | translate }}
          </div>
        </div>

        <div class="mb-3">
          <label for="strategy" class="form-label">{{ 'SALES_PLAN.STRATEGY' | translate }}</label>
          <select
            id="strategy"
            class="form-select"
            formControlName="strategy"
            [class.is-valid]="salesPlanForm.get('strategy')?.valid && (salesPlanForm.get('strategy')?.dirty || salesPlanForm.get('strategy')?.touched)"
            [class.is-invalid]="fieldIsInvalid('strategy')"
          >
            <option value="" disabled>{{ 'SALES_PLAN.SELECT_STRATEGY' | translate }}</option>
            <option *ngFor="let s of strategies" [value]="s">
              {{ 'SALES_PLAN.STRATEGIES.' + s | translate }}
            </option>
          </select>
          <div *ngIf="fieldIsInvalid('strategy')" class="text-danger small mt-1">
            {{ 'SALES_PLAN.STRATEGY_REQUIRED' | translate }}
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="mb-3">
          <label for="event" class="form-label">{{ 'SALES_PLAN.EVENT' | translate }}</label>
          <select
            id="event"
            class="form-select"
            formControlName="event"
            [class.is-valid]="salesPlanForm.get('event')?.valid && (salesPlanForm.get('event')?.dirty || salesPlanForm.get('event')?.touched)"
            [class.is-invalid]="fieldIsInvalid('event')"
          >
            <option value="" disabled>{{ 'SALES_PLAN.SELECT_EVENT' | translate }}</option>
            <option *ngFor="let e of events" [value]="e">
              {{ 'SALES_PLAN.EVENTS.' + e | translate }}
            </option>
          </select>
          <div *ngIf="fieldIsInvalid('event')" class="text-danger small mt-1">
            {{ 'SALES_PLAN.EVENT_REQUIRED' | translate }}
          </div>
        </div>

        <div class="mb-3">
          <label for="dailyGoal" class="form-label">{{ 'SALES_PLAN.DAILY_GOAL' | translate }}</label>
          <input
            type="number"
            id="dailyGoal"
            class="form-control"
            formControlName="dailyGoal"
            min="1"
            placeholder="{{ 'SALES_PLAN.DAILY_PLACEHOLDER' | translate }}"
            [class.is-valid]="salesPlanForm.get('dailyGoal')?.valid && (salesPlanForm.get('dailyGoal')?.dirty || salesPlanForm.get('dailyGoal')?.touched)"
            [class.is-invalid]="fieldIsInvalid('dailyGoal')"
          />
          <div *ngIf="fieldIsInvalid('dailyGoal')" class="text-danger small mt-1">
            {{ 'SALES_PLAN.DAILY_REQUIRED' | translate }}
          </div>
        </div>

        <div class="mb-3">
          <label for="weeklyGoal" class="form-label">{{ 'SALES_PLAN.WEEKLY_GOAL' | translate }}</label>
          <input
            type="number"
            id="weeklyGoal"
            class="form-control"
            formControlName="weeklyGoal"
            min="1"
            placeholder="{{ 'SALES_PLAN.WEEKLY_PLACEHOLDER' | translate }}"
            [class.is-valid]="salesPlanForm.get('weeklyGoal')?.valid && (salesPlanForm.get('weeklyGoal')?.dirty || salesPlanForm.get('weeklyGoal')?.touched)"
            [class.is-invalid]="fieldIsInvalid('weeklyGoal')"
          />
          <div *ngIf="fieldIsInvalid('weeklyGoal')" class="text-danger small mt-1">
            {{ 'SALES_PLAN.WEEKLY_REQUIRED' | translate }}
          </div>
        </div>

        <div class="form-row d-flex gap-3">
          <div class="mb-3 w-50">
            <label for="startTime" class="form-label">{{ 'SALES_PLAN.START_TIME' | translate }}</label>
            <input
              type="time"
              id="startTime"
              class="form-control"
              formControlName="startTime"
              [class.is-valid]="salesPlanForm.get('startTime')?.valid && !salesPlanForm.errors?.['invalidTimeRange'] && (salesPlanForm.get('startTime')?.dirty || salesPlanForm.get('startTime')?.touched)"
              [class.is-invalid]="fieldIsInvalid('startTime') || salesPlanForm.errors?.['invalidTimeRange']"
            />
          </div>

          <div class="mb-3 w-50">
            <label for="endTime" class="form-label">{{ 'SALES_PLAN.END_TIME' | translate }}</label>
            <input
              type="time"
              id="endTime"
              class="form-control"
              formControlName="endTime"
              [class.is-valid]="salesPlanForm.get('endTime')?.valid && !salesPlanForm.errors?.['invalidTimeRange'] && (salesPlanForm.get('endTime')?.dirty || salesPlanForm.get('endTime')?.touched)"
              [class.is-invalid]="fieldIsInvalid('endTime') || salesPlanForm.errors?.['invalidTimeRange']"
            />
          </div>
        </div>

        <div *ngIf="salesPlanForm.errors?.['invalidTimeRange']" class="text-danger small mt-2">
          {{ 'SALES_PLAN.INVALID_TIME_RANGE' | translate }}
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-end mt-4 gap-3">
      <button type="submit" class="btn btn-primary" [disabled]="salesPlanForm.invalid || isLoading">
        <span *ngIf="!isLoading">{{ 'COMMON.SAVE' | translate }}</span>
        <span *ngIf="isLoading">
          <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
          {{ 'COMMON.PROCESSING' | translate }}
        </span>
      </button>

      <button type="button" class="btn btn-outline-secondary" (click)="onCancel()" [disabled]="isLoading">
        {{ 'COMMON.CANCEL' | translate }}
      </button>
    </div>
  </form>
</div>
